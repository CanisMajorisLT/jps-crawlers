{"version":3,"sources":["../../../src/crawlers/common/scrape.js"],"names":[],"mappings":";;;;;QAGgB;;;;;;;;;;AAAT,SAAS,WAAT,CAAqB,GAArB,EAA0B,OAA1B,EAAkC;;AACrC,QAAI,aAAa,WAAW,CAAX,CADoB;AAErC,QAAI,aAAa,CAAb,CAFiC;;AAIrC,QAAI,QAAJ,CAJqC;AAKrC,QAAI,OAAJ,CALqC;AAMrC,QAAI,WAAW,IAAI,OAAJ,CAAY,UAAS,GAAT,EAAa,GAAb,EAAiB;AACxC,mBAAW,GAAX,CADwC;AAExC,kBAAU,GAAV,CAFwC;KAAjB,CAAvB,CANiC;;AAWrC,aAAS,YAAT,GAAuB;AACnB,gBAAQ,GAAR,EACK,IADL,CACU,UAAS,IAAT,EAAc;AAChB,qBAAS,IAAT,EADgB;SAAd,CADV,CAIK,KAJL,CAIW,UAAS,KAAT,EAAe;AAClB,yBADkB;AAElB,gBAAI,aAAa,UAAb,EAAyB;AACzB,2BAAW,YAAX,EAAyB,aAAc,GAAd,CAAzB,CADyB;aAA7B,MAGM;AACF,wBAAQ,4BAAe,GAAf,EAAoB,MAAM,KAAN,CAA5B,EADE;aAHN;SAFG,CAJX,CADmB;KAAvB;;AAgBA,mBA3BqC;;AA8BrC,WAAO,QAAP,CA9BqC;CAAlC;;AAkCP,SAAS,OAAT,CAAiB,GAAjB,EAAsB;AAClB,QAAI,UAAU;AACV,gBAAQ,IAAR;AACA,aAAK,GAAL;KAFA,CADc;;AAMlB,WAAO,8BAAe,OAAf,CAAP,CANkB;CAAtB","file":"scrape.js","sourcesContent":["import requestPromise from 'request-promise'\r\nimport { makeFetchError } from './errors'\r\n\r\nexport function getPageBody(uri, retries){ //TODO test\r\n    var triesLimit = retries || 5;\r\n    var currentTry = 0;\r\n\r\n    var resolveR;\r\n    var rejectR;\r\n    var promiseR = new Promise(function(res,rej){\r\n        resolveR = res;\r\n        rejectR = rej\r\n    });\r\n\r\n    function recursiveGet(){\r\n        getPage(uri)\r\n            .then(function(body){\r\n                resolveR(body)\r\n            })\r\n            .catch(function(error){\r\n                currentTry++;\r\n                if (currentTry < triesLimit) {\r\n                    setTimeout(recursiveGet, currentTry  * 100)\r\n                }\r\n                 else {\r\n                    rejectR(makeFetchError(uri, error.error))\r\n                }\r\n            });\r\n    }\r\n\r\n    recursiveGet();\r\n\r\n\r\n    return promiseR\r\n\r\n};\r\n\r\nfunction getPage(uri) {\r\n    var options = {\r\n        simple: true, // reject if statusCode !== 2xx\r\n        uri: uri\r\n    };\r\n\r\n    return requestPromise(options)\r\n\r\n}\r\n\r\n\r\n\r\n"]}