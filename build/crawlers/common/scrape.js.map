{"version":3,"sources":["crawlers/common/scrape.js"],"names":[],"mappings":";;;;;QAGgB,W,GAAA,W;;AAHhB;;;;AACA;;;;AAEO,SAAS,WAAT,CAAqB,GAArB,EAA0B,OAA1B,EAAkC;;AACrC,QAAI,aAAa,WAAW,CAA5B;AACA,QAAI,aAAa,CAAjB;;AAEA,QAAI,QAAJ;AACA,QAAI,OAAJ;AACA,QAAI,WAAW,IAAI,OAAJ,CAAY,UAAS,GAAT,EAAa,GAAb,EAAiB;AACxC,mBAAW,GAAX;AACA,kBAAU,GAAV;AACH,KAHc,CAAf;;AAKA,aAAS,YAAT,GAAuB;AACnB,gBAAQ,GAAR,EACK,IADL,CACU,UAAS,IAAT,EAAc;AAChB,qBAAS,IAAT;AACH,SAHL,EAIK,KAJL,CAIW,UAAS,KAAT,EAAe;AAClB;AACA,gBAAI,aAAa,UAAjB,EAA6B;AACzB,2BAAW,YAAX,EAAyB,aAAc,GAAvC;AACH,aAFD,MAGM;AACF,wBAAQ,4BAAe,GAAf,EAAoB,MAAM,KAA1B,CAAR;AACH;AACJ,SAZL;AAaH;;AAED;;AAGA,WAAO,QAAP;AAEH;;AAED,SAAS,OAAT,CAAiB,GAAjB,EAAsB;AAClB,QAAI,UAAU;AACV,gBAAQ,IADE,E;AAEV,aAAK;AAFK,KAAd;;AAKA,WAAO,8BAAe,OAAf,CAAP;AAEH","file":"crawlers/common/scrape.js","sourcesContent":["import requestPromise from 'request-promise'\r\nimport { makeFetchError } from './errors'\r\n\r\nexport function getPageBody(uri, retries){ //TODO test\r\n    var triesLimit = retries || 5;\r\n    var currentTry = 0;\r\n\r\n    var resolveR;\r\n    var rejectR;\r\n    var promiseR = new Promise(function(res,rej){\r\n        resolveR = res;\r\n        rejectR = rej\r\n    });\r\n\r\n    function recursiveGet(){\r\n        getPage(uri)\r\n            .then(function(body){\r\n                resolveR(body)\r\n            })\r\n            .catch(function(error){\r\n                currentTry++;\r\n                if (currentTry < triesLimit) {\r\n                    setTimeout(recursiveGet, currentTry  * 100)\r\n                }\r\n                 else {\r\n                    rejectR(makeFetchError(uri, error.error))\r\n                }\r\n            });\r\n    }\r\n\r\n    recursiveGet();\r\n\r\n\r\n    return promiseR\r\n\r\n};\r\n\r\nfunction getPage(uri) {\r\n    var options = {\r\n        simple: true, // reject if statusCode !== 2xx\r\n        uri: uri\r\n    };\r\n\r\n    return requestPromise(options)\r\n\r\n}\r\n\r\n\r\n\r\n"],"sourceRoot":"/source/"}