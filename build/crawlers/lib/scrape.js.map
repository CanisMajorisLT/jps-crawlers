{"version":3,"sources":["crawlers/lib/scrape.js"],"names":["getPageBody","uri","retries","triesLimit","currentTry","resolveR","rejectR","promiseR","Promise","res","rej","recursiveGet","getPage","then","body","catch","error","setTimeout","options","simple"],"mappings":";;;;;QAGgBA,W,GAAAA,W;;AAHhB;;;;AACA;;;;AAEO,SAASA,WAAT,CAAqBC,GAArB,EAA0BC,OAA1B,EAAkC;AAAE;AACvC,QAAIC,aAAaD,WAAW,CAA5B;AACA,QAAIE,aAAa,CAAjB;;AAEA,QAAIC,QAAJ;AACA,QAAIC,OAAJ;AACA,QAAIC,WAAW,IAAIC,OAAJ,CAAY,UAASC,GAAT,EAAaC,GAAb,EAAiB;AACxCL,mBAAWI,GAAX;AACAH,kBAAUI,GAAV;AACH,KAHc,CAAf;;AAKA,aAASC,YAAT,GAAuB;AACnBC,gBAAQX,GAAR,EACKY,IADL,CACU,UAASC,IAAT,EAAc;AAChBT,qBAASS,IAAT;AACH,SAHL,EAIKC,KAJL,CAIW,UAASC,KAAT,EAAe;AAClBZ;AACA,gBAAIA,aAAaD,UAAjB,EAA6B;AACzBc,2BAAWN,YAAX,EAAyBP,aAAc,GAAvC;AACH,aAFD,MAGM;AACFE,wBAAQ,4BAAeL,GAAf,EAAoBe,MAAMA,KAA1B,CAAR;AACH;AACJ,SAZL;AAaH;;AAEDL;;AAGA,WAAOJ,QAAP;AAEH;;AAED,SAASK,OAAT,CAAiBX,GAAjB,EAAsB;AAClB,QAAIiB,UAAU;AACVC,gBAAQ,IADE,EACI;AACdlB,aAAKA;AAFK,KAAd;;AAKA,WAAO,8BAAeiB,OAAf,CAAP;AAEH","file":"crawlers/lib/scrape.js","sourcesContent":["import requestPromise from 'request-promise'\nimport { makeFetchError } from './errors'\n\nexport function getPageBody(uri, retries){ //TODO test\n    var triesLimit = retries || 5;\n    var currentTry = 0;\n\n    var resolveR;\n    var rejectR;\n    var promiseR = new Promise(function(res,rej){\n        resolveR = res;\n        rejectR = rej\n    });\n\n    function recursiveGet(){\n        getPage(uri)\n            .then(function(body){\n                resolveR(body)\n            })\n            .catch(function(error){\n                currentTry++;\n                if (currentTry < triesLimit) {\n                    setTimeout(recursiveGet, currentTry  * 100)\n                }\n                 else {\n                    rejectR(makeFetchError(uri, error.error))\n                }\n            });\n    }\n\n    recursiveGet();\n\n\n    return promiseR\n\n}\n\nfunction getPage(uri) {\n    var options = {\n        simple: true, // reject if statusCode !== 2xx\n        uri: uri\n    };\n\n    return requestPromise(options)\n\n}\n\n\n\n"],"sourceRoot":"/source/"}