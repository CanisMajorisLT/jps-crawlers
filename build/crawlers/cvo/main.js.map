{"version":3,"sources":["crawlers/cvo/main.js"],"names":[],"mappings":";;;;;;;wDAWA,iBAAwB,kBAAxB,EAA4C,MAA5C,EAAoD,MAApD;AAAA,YAEQ,cAFR,EAGU,iBAHV,EAIU,SAJV,EAMU,MANV,EAOU,sBAPV,EAYU,KAZV,EAeU,KAfV;AAAA;AAAA;AAAA;AAAA;AAEQ,sCAFR,GAEyB,oCAAyB,KAAzB,CAFzB;AAGU,yCAHV,GAG8B,oCAAyB,KAAzB,EAAgC,kBAAhC,CAH9B;AAIU,iCAJV,GAIsB,yCAA8B,cAA9B,2BAJtB;AAMU,8BANV,GAMmB,4CAAmB,SAAnB,EAA8B,eAAe,OAA7C,EAAsD,iBAAtD,CANnB;AAOU,8CAPV,GAOmC,gBAAO,KAAP,CAAa,MAAb,EAAqB,OAAO,OAAP,CAAe,OAAf,IAA0B,sBAA/C,CAPnC;;AAQI,4BAAG,WAAW,SAAd,EAAyB,uBAAuB,KAAvB,GAA+B,MAA/B;;AAEzB,uCAAe,QAAf,CAAwB,sBAAxB,E;;AAVJ;AAAA,+BAYwB,iCAAsB,eAAe,OAAf,CAAuB,SAAvB,EAAkC,KAAlC,CAAtB,gCAZxB;;AAAA;AAYU,6BAZV;;AAaI,yCAAO,IAAP,kBAA2B,KAA3B;;AAEM,6BAfV,GAekB,kCAAuB,KAAvB,EAA8B,CAA9B,EAAiC,OAAO,IAAxC,CAflB;;;AAiBI,+CAAuB,IAAvB,CAA4B,KAA5B;;AAjBJ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,K;;oBAAe,Q;;;;;AAXf;;;;AACA;;AACA;;AACA;;AAEA;;;;;;;;AAEA,IAAM,iBAAiB,0DAAvB;AACA,IAAM,yBAAyB,CAA/B;;kBAuBe,Q","file":"crawlers/cvo/main.js","sourcesContent":["import { default as async_ } from 'async'\r\nimport { extractTotalPageCount, extractFrontInfo } from './parser'\r\nimport { queueWorkerFactory } from '../common/queueWorkerFactory'\r\nimport { generateFrontInfoTasks, getNumberOfFrontPages,\r\n    parseFrontPageArticlesFactory, handleTaskSuccessFactory, handleTaskFailureFactory } from '../common/core'\r\nimport logger from '../../../logging/logger'\r\n\r\nconst FRONT_PAGE_URI = 'http://www.cvonline.lt/darbo-skelbimai/visi?page=${page}';\r\nconst DEFAULT_WORKERS_NUMBER = 1;\r\n\r\n\r\nasync function parseCVO(taskSuccessHandler, config, onDone) {\r\n\r\n    let handleTaskFail = handleTaskFailureFactory('CVO');\r\n    const handleTaskSuccess = handleTaskSuccessFactory('CVO', taskSuccessHandler);\r\n    const adsParser = parseFrontPageArticlesFactory(FRONT_PAGE_URI, extractFrontInfo);\r\n\r\n    const worker = queueWorkerFactory(adsParser, handleTaskFail.handler, handleTaskSuccess);\r\n    const FrontInfoFetchingQueue = async_.queue(worker, config.general.workers || DEFAULT_WORKERS_NUMBER);\r\n    if(onDone !== undefined) FrontInfoFetchingQueue.drain = onDone;\r\n\r\n    handleTaskFail.setQueue(FrontInfoFetchingQueue); // so task can be requeued on fail\r\n\r\n    const pages = await getNumberOfFrontPages(FRONT_PAGE_URI.replace('${page}', '200'), extractTotalPageCount);\r\n    logger.info(`Page count: ${pages}`);\r\n\r\n    const tasks = generateFrontInfoTasks(pages, 1, config.task);\r\n\r\n    FrontInfoFetchingQueue.push(tasks)\r\n}\r\n\r\nexport default parseCVO\r\n\r\n\r\n\r\n\r\n\r\n"],"sourceRoot":"/source/"}