{"version":3,"sources":["../../src/crawlers/cvb/scraper.js"],"names":[],"mappings":";;AAAA,IAAI,KAAK,QAAQ,iBAAR,CAAL;AACJ,IAAI,IAAI,QAAQ,SAAR,CAAJ;AACJ,IAAI,QAAQ,QAAQ,OAAR,CAAR;AACJ,IAAI,UAAU,sCAAV;;AAEJ,SAAS,cAAT,CAAwB,IAAxB,EAA8B;AAC1B,QAAI,IAAI,EAAE,IAAF,CAAO,IAAP,CAAJ,CADsB;AAE1B,QAAI,WAAW,EAAE,YAAF,EAAgB,GAAhB,EAAX,CAFsB;AAG1B,YAAQ,GAAR,CAAY,UAAZ,EAAwB,QAAxB,EAH0B;AAI1B,QAAI,SAAS,MAAT,GAAkB,CAAlB,EAAqB;AACrB,eAAO,IAAP,CADqB;KAAzB,MAEO;AACH,eAAO,SAAS,MAAT,CAAgB,UAAS,CAAT,EAAY,CAAZ,EAAc;AACjC,oBAAQ,GAAR,CAAY,CAAZ,EAAe,CAAf,EADiC;AAEjC,gBAAI,OAAO,EAAE,CAAF,EAAK,IAAL,CAAU,MAAV,CAAP,CAF6B;AAGjC,gBAAI,OAAO,EAAE,CAAF,EAAK,IAAL,CAAU,MAAV,CAAP,CAH6B;;AAKjC,mBAAO,SAAS,KAAK,KAAL,CAAW,KAAX,EAAkB,CAAlB,CAAT,IAAiC,SAAS,KAAK,KAAL,CAAW,KAAX,EAAkB,CAAlB,CAAT,CAAjC,GAAkE,IAAlE,GAAyE,IAAzE,CAL0B;SAAd,CAAvB,CADG;KAFP;CAJJ;;AAoBA,SAAS,mBAAT,CAA6B,GAA7B,EAAkC;AAC9B,QAAI,QAAQ;AACR,gBAAQ,KAAR;AACA,aAAK,GAAL;KAFA,CAD0B;;AAM9B,WAAO,IAAI,OAAJ,CAAY,UAAS,OAAT,EAAkB,MAAlB,EAA0B;AACzC,WAAG,KAAH,EACK,IADL,CACU,UAAS,IAAT,EAAe;AAClB,oBAAQ;AACJ,sBAAM,IAAN;AACA,yBAAS,eAAe,IAAf,CAAT;aAFJ,EADkB;SAAf,CADV,CAOK,KAPL,CAOW,YAAW;AACd,mBAAO,MAAM,QAAN,CAAP,EADc;SAAX,CAPX,CADyC;KAA1B,CAAnB,CAN8B;CAAlC;;AAoBA,oBAAoB,gCAApB,EACK,IADL,CACU,UAAS,CAAT,EAAW;AACb,YAAQ,GAAR,CAAY,CAAZ,EADa;CAAX,CADV;;AAMA,SAAS,MAAT,CAAgB,GAAhB,EAAqB;AACjB,OAAG;AACC,gBAAQ,KAAR;AACA,aAAK,gCAAL;KAFJ,EAIK,IAJL,CAIU,UAAS,IAAT,EAAe,EAAf,CAJV,CAOK,KAPL,CAOW,UAAS,KAAT,EAAgB,EAAhB,CAPX,CADiB;CAArB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA4CA,SAAS,gBAAT,CAA0B,OAA1B,EAAmC;AAC/B,QAAI,KAAK,EAAE,IAAF,CAAO,OAAP,CAAL,CAD2B;AAE/B,WAAO;AACH,aAAK,GAAG,GAAH,EAAQ,IAAR,CAAa,MAAb,CAAL;AACA,eAAO,GAAG,eAAH,EAAoB,IAApB,EAAP;AACA,YAAI,GAAG,wBAAH,EAA6B,IAA7B,CAAkC,OAAlC,CAAJ;KAHJ,CAF+B;CAAnC;;AAUA,SAAS,MAAT,CAAgB,GAAhB,EAAqB;AACjB,WAAO,GAAG;AACN,gBAAQ,KAAR;AACA,aAAK,GAAL;KAFG,CAAP,CADiB;CAArB;;AAOA,SAAS,iBAAT,CAA2B,OAA3B,EAAoC;;AAEhC,QAAI,OAAO,OAAP,CAF4B;;AAIhC,YAAQ,GAAR,CAAY,KAAK,IAAL,EAAZ,EAJgC;;AAMhC,YAAQ,GAAR,CAAY,EAAE,aAAF,EAAiB,IAAjB,EAAZ,EANgC;CAApC","file":"scraper.js","sourcesContent":["var rp = require('request-promise');\r\nvar $ = require('cheerio');\r\nvar async = require('async');\r\nvar ADS_URL = 'http://www.cvbankas.lt/?page=${page}';\r\n\r\nfunction getNextPageUri(body) {\r\n    var p = $.load(body);\r\n    var prevNext = p('.prev_next').get();\r\n    console.log('prevNext', prevNext);\r\n    if (prevNext.length < 2) {\r\n        return null\r\n    } else {\r\n        return prevNext.reduce(function(f, s){\r\n            console.log(f, s);\r\n            var fUrl = $(f).attr('href');\r\n            var sUrl = $(s).attr('href');\r\n\r\n            return parseInt(fUrl.match(/\\d+/)[0]) > parseInt(sUrl.match(/\\d+/)[0]) ? fUrl : sUrl\r\n\r\n\r\n        })\r\n    }\r\n}\r\n\r\n\r\nfunction getBodyWithArticles(uri) {\r\n    var query = {\r\n        method: 'GET',\r\n        uri: uri\r\n    };\r\n\r\n    return new Promise(function(resolve, reject) {\r\n        rp(query)\r\n            .then(function(body) {\r\n               resolve({\r\n                   body: body,\r\n                   nextUri: getNextPageUri(body)\r\n               })\r\n            })\r\n            .catch(function() {\r\n                reject(Error('failed'))\r\n            })\r\n    })\r\n}\r\n\r\ngetBodyWithArticles('http://www.cvbankas.lt/?page=1')\r\n    .then(function(r){\r\n        console.log(r);\r\n    })\r\n\r\n\r\nfunction getAds(url) {\r\n    rp({\r\n        method: 'GET',\r\n        uri: 'http://www.cvbankas.lt/?page=1'\r\n    })\r\n        .then(function(body) {\r\n\r\n        })\r\n        .error(function(error) {\r\n\r\n        })\r\n}\r\n\r\n/*rp({\r\n    method: 'GET',\r\n    uri: 'http://www.cvbankas.lt/?page=1',\r\n    transform: function(body) {\r\n        return $.load(body)\r\n    }\r\n})\r\n    .then(function(r) {\r\n        var frontData = r('#job_ad_list article').map((s, e)=> {\r\n            return extractFrontInfo(e);\r\n        });\r\n\r\n        async.eachSeries(frontData, function(info, cb) {\r\n            console.log(info);\r\n            rp({\r\n                method: 'GET',\r\n                uri: info.url,\r\n                transform: function(body) {\r\n                    return $.load(body)\r\n                }\r\n            })\r\n                .then(function(result) {\r\n                    extractInsideInfo(result);\r\n                    setTimeout(cb, 5000)\r\n                })\r\n\r\n\r\n        });\r\n    });*/\r\n\r\n\r\nfunction extractFrontInfo(element) {\r\n    var ad = $.load(element);\r\n    return {\r\n        url: ad('a').attr('href'),\r\n        title: ad('.list_cell h3').text(),\r\n        id: ad('form input[name=ad_id]').attr('value')\r\n    }\r\n\r\n}\r\n\r\nfunction getUrl(url) {\r\n    return rp({\r\n        method: 'GET',\r\n        uri: url\r\n    })\r\n}\r\n\r\nfunction extractInsideInfo(element) {\r\n\r\n    var page = element;\r\n\r\n    console.log(page.html());\r\n\r\n    console.log($('#jobad_cont').html());\r\n}\r\n\r\n\r\n\r\n"]}